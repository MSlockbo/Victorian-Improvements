
integrate_subject = {
	requires_approval = yes
	should_notify_third_parties = yes
	can_use_obligations = yes

	potential = {
		scope:target_country = {
			is_direct_subject_of = root

			custom_tooltip = {
				text = DIPLO_ACTION_MARKET_CONNECTION_REQUIRED
				OR = {	
					AND = {
						market = { has_port = yes }
						scope:target_country.market = { has_port = yes }
					}
					scope:actor.market = {
						any_scope_country = {
							is_adjacent_to_country = root
						}
					}
				}
			}

			NOT = { has_journal_entry = je_integration_target }

			OR = {
				is_subject_type = subject_type_puppet
				is_subject_type = subject_type_vassal
			}
			NOT = {
				is_country_type = colonial
			}
		}
	}

	possible = {
		custom_tooltip = {
			text = integration_in_progress_tt

			NOT = { has_journal_entry = je_integrate_subject }
		}

		bureaucracy >= 1000

		is_revolutionary = no

		scope:target_country = {
			is_revolutionary = no
			NOT = { has_truce_with = root }
		}

		is_at_war = no
		scope:target_country = { is_at_war = no }
	}

	accept_effect = {
		if = {
			limit = {
				NOT = { has_journal_entry = je_integrate_subject }
			}

			custom_tooltip = {
				text = begin_integration_tt

				scope:target_country = {
					add_journal_entry = { type = je_integration_target }
				}
				add_journal_entry = { type = je_integrate_subject }
			}
		}
	}

	# This is the acceptance score for the junior part of the customs union
	junior_accept_score = {
		value = 0

		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_BASE"
			value = -100
		}

		if = {
			limit = {
				NOR = {
					scope:actor.market = {
						any_scope_country = {
							is_adjacent_to_country = root
						}
					}
					scope:actor = {
						has_diplomatic_pact = { who = root type = customs_union }
					}
				}
			}
			add = {
				desc = "DIPLOMATIC_ACCEPTANCE_NOT_ADJACENT_MARKETS"
				value = -20
			}
		}

		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_GDP"
			value = "scope:actor.ai_gdp_comparison(root)"
			multiply = 2
			min = -2000
			max = 2000
		}
				
		if = {
			limit = {
				gdp >= 2000000
			}
			
			subtract = {
				desc = "DIPLOMATIC_ACCEPTANCE_HIGH_GDP"
				value = gdp
				subtract = 1000000
				divide = 1000000
				min = 1
				max = 100
			}
		}			
		
		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_MUTUAL_TRADE_ROUTES"
			value = "scope:actor.num_mutual_trade_route_levels_with_country(root)"
			multiply = 0.5
			max = 25
		}				

		if = {
			limit = {
				"scope:actor.ai_ideological_opinion(root)" > 0
			}
			add = {
				desc = "DIPLOMATIC_ACCEPTANCE_IDEOLOGICAL_OPINION"
				value = "scope:actor.ai_ideological_opinion(root)"
				multiply = 0.5
				max = 20
			}					
		}
		else_if = {
			limit = {
				"scope:actor.ai_ideological_opinion(root)" < 0
			}
			add = {
				desc = "DIPLOMATIC_ACCEPTANCE_IDEOLOGICAL_OPINION_NEGATIVE"
				value = "scope:actor.ai_ideological_opinion(root)"
				multiply = 0.5
				min = -20
			}					
		}		

		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_ATTITUDE"
			if = {
				limit = {
					has_attitude = {
						who = scope:actor
						attitude = loyal
					}
				}
				value = 40
			}
			if = {
				limit = {
					has_attitude = {
						who = scope:actor
						attitude = genial
					}
				}
				value = 30
			}				
			if = {
				limit = {
					OR = {
						has_attitude = {
							who = scope:actor
							attitude = conciliatory
						}	
						has_attitude = {
							who = scope:actor
							attitude = cooperative
						}							
					}
				}
				value = 20
			}
			if = {
				limit = {
					has_attitude = {
						who = scope:actor
						attitude = cautious
					}
				}
				value = -50
			}
			if = {
				limit = {
					OR = {
						has_attitude = {
							who = scope:actor
							attitude = protective
						}							
						has_attitude = {
							who = scope:actor
							attitude = antagonistic
						}
						has_attitude = {
							who = scope:actor
							attitude = domineering
						}
						has_attitude = {
							who = scope:actor
							attitude = belligerent
						}
						has_attitude = {
							who = scope:actor
							attitude = rebellious
						}
					}
				}
				value = -1000
			}
		}

		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_RELATIONS"
			if = {
				limit = {
					"relations(scope:actor)" >= relations_threshold:amicable
					"relations(scope:actor)" < relations_threshold:friendly
				}
				value = 20
			}
			if = {
				limit = {
					"relations(scope:actor)" >= relations_threshold:friendly
				}
				value = 50
			}
		}

		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_INFAMY"
			if = {
				limit = {
					"scope:actor.infamy" >= infamy_threshold:infamous
					"scope:actor.infamy" < infamy_threshold:notorious
				}
				value = -10
			}
			if = {
				limit = {
					"scope:actor.infamy" >= infamy_threshold:notorious
					"scope:actor.infamy" < infamy_threshold:pariah
				}
				value = -25
			}
			if = {
				limit = {
					"scope:actor.infamy" >= infamy_threshold:pariah
				}
				value = -50
			}
		}

		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_RANK"

			if = {
				limit = { scope:actor = { country_rank = root.country_rank } }
				value = -20
			}

			if = {
				limit = { scope:actor = { country_rank < root.country_rank } }
				value = -50
			}
		}

		add = {
			desc = "DIPLOMATIC_ACCEPTANCE_INCOMPATIBLE_ECONOMIC_SYSTEMS"
			if = {
				limit = {
					OR = {
						AND = {
							scope:actor = { has_radical_leftist_economy = no }		
							scope:target_country = { has_radical_leftist_economy = yes }							
						}
						AND = {
							scope:actor = { has_radical_leftist_economy = yes }		
							scope:target_country = { has_radical_leftist_economy = no }							
						}							
					}	
				}
				value = -50
			}
		}	
		
		if = {
			limit = {
				scope:target_country = {
					c:CHI ?= THIS
					OR = {
						country_rank >= rank_value:unrecognized_major_power
						country_rank >= rank_value:great_power
					}
				}
			}
			add = {
				desc = "DIPLOMATIC_ACCEPTANCE_IS_CHINA"
				value = -1000
			}
		}
	}
}